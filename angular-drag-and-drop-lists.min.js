angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround","$rootScope",function(e,c,d,b,a){return function(h,g,f){g.attr("draggable","true");g.on("dragstart",function(j){var k=f.dndDragImage||null;if(k){var l=e(f.dndDragImage);h.$apply(function(){var o=l(h,{$event:j});if(o&&o.image){var m=o.xOffset||0,n=o.yOffset||0;j.dataTransfer.setDragImage(o.image,m,n)}})}j.dataTransfer.setData("Text",angular.toJson(h.$eval(f.dndDraggable)));j.dataTransfer.effectAllowed=f.dndEffectAllowed||"move";g.addClass("dndDragging");c(function(){g.addClass("dndDraggingSource")},0);d.dropEffect="none";b.isDragging=true;var i=f.dndDragChannel||"dndListChannel";a.$broadcast("DNDLIST_DRAG_START",i);j.stopPropagation()});g.on("dragend",function(j){var i=f.dndDragChannel||"dndListChannel";a.$broadcast("DNDLIST_DRAG_END",i);var k=j.dataTransfer.dropEffect!=="none"?j.dataTransfer.dropEffect:d.dropEffect;k=d.dropEffect;h.$apply(function(){switch(k){case"move":e(f.dndMoved)(h);break;case"copy":e(f.dndCopied)(h);break}});g.removeClass("dndDragging");g.removeClass("dndDraggingSource");b.isDragging=false;j.stopPropagation()});g.on("click",function(i){h.$apply(function(){e(f.dndSelected)(h)});i.stopPropagation()});g.on("selectstart",function(){this.dragDrop();return false})}}]).directive("dndList",["$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround","$rootScope",function(c,d,b,a){return function(p,j,k){var i=k.dndPlaceholder||"<li class='dndPlaceholder'></li>";var n=angular.element(i);var f=n[0];var h=j[0];var g="";var m=k.dndDropChannel||"dndListChannel";function q(t,s){if(s==="*"){return true}var r=new RegExp("(\\s|[,])+("+t+")(\\s|[,])+","i");return r.test(","+s+",")}var o=a.$on("DNDLIST_DRAG_START",function(s,r){g=r});var e=a.$on("DNDLIST_DRAG_END",function(s,r){g=""});p.$on("$destroy",function(){o();e()});k.$observe("dropChannel",function(r){if(r){m=r}});j.on("dragover",function(r){if(!b.isDragging){return true}if(!l(r.dataTransfer.types)){return true}if(!q(g,m)){return true}if(f.parentNode!=h){j.append(n)}var s=r.target;while(s.parentNode!==h&&s.parentNode!==null){s=s.parentNode}if(s.parentNode===h&&s!==f){var t=(r.offsetY||r.layerY)<s.offsetHeight/2;h.insertBefore(f,t?s:s.nextSibling)}else{if(r.target===h){if(r.offsetY<f.offsetTop){while(f.previousElementSibling&&(f.previousElementSibling.offsetHeight===0||r.offsetY<f.previousElementSibling.offsetTop+f.previousElementSibling.offsetHeight/2)){h.insertBefore(f,f.previousElementSibling)}}else{while(f.nextElementSibling&&r.offsetY>f.nextElementSibling.offsetTop+f.nextElementSibling.offsetHeight/2){h.insertBefore(f,f.nextElementSibling.nextElementSibling)}}}}j.addClass("dndDragover");r.preventDefault();r.stopPropagation();return false});j.on("drop",function(s){var u=JSON.parse(s.dataTransfer.getData("Text")||s.dataTransfer.getData("text/plain"));var t=p.$eval(k.dndList);var r=Array.prototype.indexOf.call(h.children,f);p.$apply(function(){t.splice(r,0,u)});if(s.dataTransfer.dropEffect==="none"){d.dropEffect=s.dataTransfer.effectAllowed==="copyMove"?(s.ctrlKey?"copy":"move"):s.dataTransfer.effectAllowed}else{d.dropEffect=s.dataTransfer.dropEffect}n.remove();j.removeClass("dndDragover");s.preventDefault();s.stopPropagation();return false});j.on("dragleave",function(r){j.removeClass("dndDragover");c(function(){if(!j.hasClass("dndDragover")){n.remove()}},100)});function l(s){if(!s){return true}for(var r=0;r<s.length;r++){if(s[r]==="Text"||s[r]==="text/plain"){return true}}return false}}}]).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}});