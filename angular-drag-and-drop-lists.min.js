angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround","$rootScope",function(e,c,d,b,a){return function(h,g,f){g.attr("draggable","true");g.on("dragstart",function(j){var k=f.dndDragImage||null;if(k){var l=e(f.dndDragImage);h.$apply(function(){var o=l(h,{$event:j});if(o&&o.image){var m=o.xOffset||0,n=o.yOffset||0;j.dataTransfer.setDragImage(o.image,m,n)}})}j.dataTransfer.setData("Text",angular.toJson(h.$eval(f.dndDraggable)));j.dataTransfer.effectAllowed=f.dndEffectAllowed||"move";g.addClass("dndDragging");c(function(){g.addClass("dndDraggingSource")},0);d.dropEffect="none";b.isDragging=true;var i=f.dndDragChannel||"dndListChannel";a.$broadcast("DNDLIST_DRAG_START",i);j.stopPropagation()});g.on("dragend",function(j){var i=f.dndDragChannel||"dndListChannel";a.$broadcast("DNDLIST_DRAG_END",i);var k=j.dataTransfer.dropEffect!=="none"?j.dataTransfer.dropEffect:d.dropEffect;k=d.dropEffect;h.$apply(function(){switch(k){case"move":e(f.dndMoved)(h);break;case"copy":e(f.dndCopied)(h);break}});g.removeClass("dndDragging");g.removeClass("dndDraggingSource");b.isDragging=false;j.stopPropagation()});g.on("click",function(i){h.$apply(function(){e(f.dndSelected)(h)});i.stopPropagation()});g.on("selectstart",function(){this.dragDrop();return false})}}]).directive("dndList",["$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround","$rootScope",function(c,d,b,a){return function(o,i,j){var m=angular.element("<li class='dndPlaceholder'></li>");var f=m[0];var h=i[0];var g="";var l=j.dndDropChannel||"dndListChannel";function p(s,r){if(r==="*"){return true}var q=new RegExp("(\\s|[,])+("+s+")(\\s|[,])+","i");return q.test(","+r+",")}var n=a.$on("DNDLIST_DRAG_START",function(r,q){g=q});var e=a.$on("DNDLIST_DRAG_END",function(r,q){g=""});o.$on("$destroy",function(){n();e()});j.$observe("dropChannel",function(q){if(q){l=q}});i.on("dragover",function(q){if(!b.isDragging){return true}if(!k(q.dataTransfer.types)){return true}if(!p(g,l)){return true}if(f.parentNode!=h){i.append(m)}if(q.target.parentNode===h&&q.target!==f){var r=(q.offsetY||q.layerY)<q.target.offsetHeight/2;h.insertBefore(f,r?q.target:q.target.nextSibling)}else{if(q.target===h){if(q.offsetY<f.offsetTop){while(f.previousElementSibling&&(f.previousElementSibling.offsetHeight===0||q.offsetY<f.previousElementSibling.offsetTop+f.previousElementSibling.offsetHeight/2)){h.insertBefore(f,f.previousElementSibling)}}else{while(f.nextElementSibling&&q.offsetY>f.nextElementSibling.offsetTop+f.nextElementSibling.offsetHeight/2){h.insertBefore(f,f.nextElementSibling.nextElementSibling)}}}}i.addClass("dndDragover");q.preventDefault();q.stopPropagation();return false});i.on("drop",function(r){var t=JSON.parse(r.dataTransfer.getData("Text")||r.dataTransfer.getData("text/plain"));var s=o.$eval(j.dndList);var q=Array.prototype.indexOf.call(h.children,f);o.$apply(function(){s.splice(q,0,t)});if(r.dataTransfer.dropEffect==="none"){d.dropEffect=r.dataTransfer.effectAllowed==="copyMove"?(r.ctrlKey?"copy":"move"):r.dataTransfer.effectAllowed}else{d.dropEffect=r.dataTransfer.dropEffect}m.remove();i.removeClass("dndDragover");r.preventDefault();r.stopPropagation();return false});i.on("dragleave",function(q){i.removeClass("dndDragover");c(function(){if(!i.hasClass("dndDragover")){m.remove()}},100)});function k(r){if(!r){return true}for(var q=0;q<r.length;q++){if(r[q]==="Text"||r[q]==="text/plain"){return true}}return false}}}]).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}});